\documentclass[a4paper, 11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{fancyvrb} 
\usepackage{siunitx}
\usepackage[table, xcdraw, svgnames]{xcolor}
\usepackage{listings, lstautogobble}
\usepackage{subfig}
\usepackage[dutch]{babel}

\setlength{\parskip}{0.5em}

\title{Sensornetwerk Proof of Concept v0.2}
\author{Groep 5}
\date{September 2018}
\pagenumbering{gobble}

\begin{document}

\maketitle
\clearpage
\pagenumbering{arabic}
\clearpage

\section{Inleiding}
Dit document beschrijft de software implementaties van groep 5 voor het vak "Sensornetwerk Ontwerp" aan de Hogeschool van Amsterdam.

Het doel van de opdracht is om een dynamisch netwerk van sensornodes te maken, waarbij in dit document de nadruk ligt op de algemene netwerkstructuur en de implementatie in MCU van de sensornodes. Hiervoor geldt over het algemeen dat het stuk software wat in dit document beschreven wordt gelijk is voor alle sensornodes. Tijdens de ontwikkeling van de individuele sensorimplementaties (vak "Sensormodule Ontwerp") kan de code afhankelijk per node worden aangepast. 

Het doel van dit document is om een 'proof of concept' te geven van de algemene netwerkstuctuur waar de sensornodes tijdens het vak "Sensormodule Ontwerp" gebruik van zullen maken.

\section{Algemene Node Programma}
Zoals besproken in de inleiding van dit document het grootste deel van de programma code voor de node MCU's gelijk. In dit hoofdstuk wordt deze code besproken. 

\subsection{Routing}
Het is belangrijk dat het sensornetwerk dynamisch is. Dit wil zeggen dat het netwerk waarover de sensordata verstuurd wordt op ieder willekeurig moment kan veranderen. In de praktijk gebeurd dit wanneer de draadloze sensornodes van plaats veranderen of om welke reden dan ook stopt met communiceren.\\
Om voortdurend valide informatie te hebben over het netwerk, broadcasten de nodes periodiek de informatie die ze op dat moment hebben over het netwerk. De informatie bestaat uit het aantal hops dat een node denkt dat andere nodes verwijderd zijn. Uit deze informatie kunnen aanliggende nodes opmaken welke nodes te bereiken zijn via de node die net zijn netwerkinformatie broadcast.\\
Wanneer een node de netwerkinformatie van een buur ontvangt zal deze informatie worden opgeslagen in een tweedimensionaal array. Een voorbeeld situatie is te zien in figuur \ref{fig:voorbeeld} en de bijbehorende routingtable in tabel \ref{table:routingtable}.\\
In tabel \ref{table:routingtable} staat in rij N de routinginformatie die node N bezit, in kolom M staat de afstand tussen node N en node M.\\
Wanneer node Z (zender) een bericht wil sturen naar node O (Ontvanger), kijkt node Z en kolom O van zijn routingtabel. Node Z checkt in de rij van elke directe buur om de laagste hopcount te vinden. Wanneer deze is gevonden word het bericht naar de buur met de laagste hopcount verstuurd die dit proces herhaalt tot het bericht bij de ontvanger is.
\begin{figure}
\centering
\includegraphics[width=.5\textwidth, keepaspectratio]{media/Voorbeeld_netwerk.pdf}
\caption{Voorbeeld netwerk.}
\label{fig:voorbeeld}
\end{figure}
\begin{table}
\centering
\begin{tabular}{|r||r|r|r|r|r|r|}
\hline
Routingdata  & Afstand  & Afstand & Afstand & Afstand & Afstand & Afstand\\
van: & Node 1: & Node 2: & Node 3: & Node 4: & Node 5: & Node 6: \\
\hline
Node 1 & 0 & 2 & 1 & 2 & 3 & 1 \\
\hline
Node 2 & 2 & 0 & 1 & 1 & 2 & 3 \\
\hline
Node 3 & 1 & 1 & 0 & 1 & 2 & 2 \\
\hline
Node 4 & 2 & 1 & 1 & 0 & 1 & 3 \\
\hline
Node 5 & 3 & 2 & 2 & 1 & 0 & 4 \\
\hline
Node 6 & 1 & 3 & 2 & 3 & 4 & 0 \\
\hline
\end{tabular}
\caption{Routingtable van de nodes in het netwerk in figuur \ref{fig:voorbeeld}.}
\label{table:routingtable}
\end{table}
%%%%% Moet nog aangevuld worden (Zie GLO)%%%%%%%
\subsection{Flowchart}
Om de algemene node-code inzichtelijk te maken is gebruik gemaakt van ene flowchart. In Figuur~\ref{fig:flowchart} is deze flowchart te zien.

\begin{figure}[!h]
	\centering	
	\includegraphics[width=.5\textwidth, keepaspectratio]{media/Pflow.pdf}
    \caption{Nadat de node opgestart wordt (Boot) de MCU ge√Ønitialiseerd in het blok [Initialize]
     \textbf{Figuur dient in deze versie als voorbeeld en zal geupdate worden wanneer het basis ontwerp af is.}}
    \label{fig:flowchart}
\end{figure}
%Zie GLO

\subsection{Statemachine}
Omdat MCU veel aan het wachten is op berichten om deze vervolgens te verwerken is gekozen als implementatie een statemachine te gebruiken. Deze is afgebeeld in Figuur~\ref{fig:Statemachine} 
Statemachine die de verschillende states laat zien waar de Xmega in komt vanaf het opstarten.

\begin{figure}[!ht]
	\includegraphics[width=.8\textwidth, keepaspectratio]{media/Pstate.pdf}
    \caption{ \textbf{Figuur dient in deze versie als voorbeeld en zal geupdate worden wanneer het basis ontwerp af is.}}
    \label{fig:Statemachine}
\end{figure}
%Zie GLO

\section{Basisstation}

\section{ISO groep}
Om te zorgen dat de nodes van de verschillende groepen elkaars datapaketten kunnen interpreteren en doorsturen zijn er afspraken gemaakt tussen de 5 groepen. Elke groep leverde 1 afgevaardigde, de 5 afgevaardigden vormden de ISO groep. De afspraken die de ISO-groep gemaakt heeft zijn opgesteld in\cite{ISO}. 

Naast afspraken over de algemene NRF-instellingen zijn er ook afspraken gemaakt over de berichttypes en de bijbehorende headers.

Bericht headers staan in de onderstaande tabel.

\subsection*{Message Types}
\begin{table}[!ht]
\begin{tabular}{|l|l|l|}
\hline
\rowcolor[HTML]{EFEFEF} 
Mask & Description           & Pipe \\ \hline
0x1  & ID Broadcast          & 0    \\ \hline
0x2  & Routine Routing Table & 1    \\ \hline
0x3  & Receive Port Data     & 1    \\ \hline
0x4  & Broadcast Reply       & 1    \\ \hline
\end{tabular}
\end{table}

\section{Netwerk Test}
Om te bewijzen dat het netwerk waar de sensornodes op via zullen opereren werkt, zijn de volgende test uitgevoerd. 
\subsection{Routing Test}
TODO: Beschrijf een test voor het opzetten van een routing tabel met meerdere nodes.
\subsection{Basis Station test}
TODO: Beschrijf een test voor het testen van het Basisstation dat data ontvangt van meerdere nodes. 
\subsection{Demonstratie}
TODO: Beschrijf de demonstratie (oplevering blok 1).

\newpage
\bibliographystyle{ieeetr}

\bibliography{POCbronnen} 

\end{document}